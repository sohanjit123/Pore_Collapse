clc,clear all

alpha_exp=zeros(8,29);

alpha_exp(1,:)=[1.50,1.18,1.50,1.33,1.26,1.16,1.14,1.18,1.23,1.36,1.26,1.26,1.47,1.10,1.3,1.41,1.88,1.17,1.94,1.46,1.38,1.37,1.33,1.27,1.04,1.42,1.17,1.05,1.38];
alpha_exp(2,:)=[1.38771186440678,1.11010830324910,1.56904761904762,1.27689243027888	1.21746293245470,1.15370018975332,1.11336717428088,1.14285714285714,1.15696887686062,1.40909090909091	1.22780569514238,1.30594405594406,1.47916666666667,1.07716049382716,1.27566539923954	1.39864864864865	1.67875647668394,1.14634146341463,1.06369426751592,1.38058252427184,1.30468750000000,1.33542976939203,1.34169884169884,1.24045801526718,1.03374233128834,1.39473684210526,1.14766355140187,1.03773584905660,1.37704918032787];
alpha_exp(3,:)=[1.45707656612529	1.09729729729730	1.65079365079365	1.28169014084507	1.17405063291139	1.15860735009671	1.08789386401327	1.14260869565217	1.15479452054795	1.42307692307692	1.24410774410774	1.32028469750890	1.49173553719008	1.08108108108108	1.26305970149254	1.38731218697830	1.64376590330789	1.16889632107023	1.05696202531646	1.38697318007663	1.27683615819209	1.34475374732334	1.36149312377210	1.20643939393939	1.03500761035008	1.37477148080439	1.09397163120567	1.01684532924962	1.24372759856631];
alpha_exp(4,:)=[1.46666666666667	1.00585937500000	1.70886075949367	1.21663442940039	1.07894736842105	1.17509727626459	1.05911330049261	1.16089965397924	1.07253886010363	1.46972860125261	1.18585526315789	1.19163763066202	1.44871794871795	1.08548387096774	1.26266416510319	1.34266886326194	1.52941176470588	1.12833333333333	1.04928457869634	1.41188118811881	1.19542253521127	1.33901918976546	1.31261770244821	1.16129032258065	1.02698650674663	1.36231884057971	1.03938356164384	1.00914634146341	1.10097719869707];
alpha_exp(5,:)=[1.53172205438066	1.09543568464730	1.89772727272727	1.25206611570248	1.03244005641749	1.17543859649123	1.04285714285714	1.18652849740933	1.01375000000000	1.47727272727273	1.10845295055821	1.14867256637168	1.41588785046729	1.14684014869888	1.20967741935484	1.18849840255591	1.27720739219713	1.08672566371681	1.06730769230769	1.35856573705179	1.14625850340136	1.32911392405063	1.34442270058708	1.11816578483245	1.02092675635277	1.24086378737542	1.03531300160514	1.01759530791789	1.01474926253687];
alpha_exp(6,:)=[1.09873949579832	1.08314087759815	1.27176781002639	1.09635974304069	1.02346041055718	1.06502636203866	1.34029227557411	1.12032520325203	1.00865051903114	1.36666666666667	1.01016949152542	1.00177935943060	1.04496402877698	1.56521739130435	1.18108651911469	1.04025764895330	1.13545816733068	1.02197802197802	1.02473498233216	1.04629629629630	1.01530612244898	1.13285457809695	1.20701754385965	1.06111111111111	1.00952380952381	1.02185792349727	1.01123595505618	1.00573065902579	1.04573170731707];
alpha_exp(7,:)=[1.00000000000000	1.00000000000000	1.07038834951456	1.14666666666667	1.09340659340659	1.03417266187050	1.08695652173913	1.01746031746032	1.02201834862385	1.10771992818671	1.28703703703704	1.03853564547206	1.00187617260788	1.24511930585683	1.23758099352052	1.18587360594796	1.01543739279588	1.29166666666667	1.06420233463035	1.02996254681648	1.02577319587629	1.01518026565465	1.14419475655431	1.05992509363296	1.00176366843034	1.02714932126697	1	1.03095975232198	1.01821192052980];
alpha_exp(8,:)=[1.29397590361446	1.05288461538462	1.16079295154185	1.08536585365854	1.14122137404580	1.06603773584906	1.06542056074766	1.13586956521739	1.03313840155945	1.02925989672978	1.22664015904573	1.00000000000000	1.13357400722022	1.07407407407407	1.03584229390681	1.10746812386157	1.00330578512397	1.02439024390244	1.08333333333333	1.08901515151515	1.00972447325770	1.01557093425606	1.22912205567452	1.05604203152364	1.09157509157509	1.00141242937853	1.04432624113475	1.04601769911504	1.09764918625678];

txray=[0;153;153*2;153*3;153*4;153*6;153*8;153*10];

for i=1:size(alpha_exp,2)
plot(txray,alpha_exp(:,i),'-*','LineWidth',3)
hold on
end

xlabel('Time (nanoseconds)')
ylabel('Distension \alpha')
ax=gca;
ax.FontSize = 16.0;
ax.LineWidth = 1.0;
% 
% 

figure(2)
for i=1:size(alpha_exp,2)
alpha=GetAlpha(alpha_exp(1,i));
alpha=alpha(alpha>1);
plot(alpha,'LineWidth',3)
hold on
end

xlabel('Time (nanoseconds)')
ylabel('Distension \alpha')
ax=gca;
ax.FontSize = 16.0;
ax.LineWidth = 1.0;

% plot(time(1:(k))/1e-9,alpha(1:(k)),'r*-','LineWidth',3)
% xlabel('Time (nanoseconds)')
% ylabel('Distension \alpha')
% ax=gca;
% ax.FontSize = 16.0;
% ax.LineWidth = 1.0;

function alpha=GetAlpha(alpha0)



%%%Dynamic pore collapse
d=1e-9; %nanosecond
% alpha0=1.2;

a0=550e-6;
rho=8.93e3; % density for SLG
C=385; %specific heat for SLG
Tm=1356; %Melting Temp

G=30e9; % Shear Modulus
Y=30e6;% Yield Strength

T0=293; %Ambient Temperature


 Y1=30e6/(1-(T0/Tm)); %Yield Strength for SLG Michael Ashby 2013


  A=-1.626;
    B=4239;
 TO=265.7;


% Y1=400e6;
% 
%  B=4239;

%   B=5765;

% eta_m=2e-3; %change later

eta_m=10^(A+B/(Tm-273-TO));

const=(d/(rho*C));

Pf=1*1e9; 
 
tau=2e-6;

time=0:d:tau;
tsteps=length(time);
P=linspace(0,Pf,tsteps);

 alpha=zeros(length(P),1);

 a=zeros(length(P),1);
 b=zeros(length(P),1);
 x=zeros(length(P),1);


alpha(1)=alpha0;


a(1)=a0;
% a(2)=a(1);
b(1)=bee(a(1),a0,alpha0);
x(1)=0;

r0=linspace(a(1),b(1),100);

T=zeros(length(P),length(r0));

rdotbyr=zeros(length(P),length(r0));

T(1,:)=T0;

 
for k=1:length(time)


  %a loop%
  
  k1=x(k);
  k2=x(k);
  k3=x(k);
  k4=x(k);

%   a(k+1)=a(k)+(d/6)*(k1+2*k2+2*k3+k4);

a(k+1)=a(k)+d*x(k);

  alpha(k+1)= 1+((alpha0-1)*(a(k+1)^3)/(a0^3));

  %x loop

  r=zeros(length(r0),1);
% 
      for i=1:length(r0)
             r(i)=arr(r0(i),a0,a(k));
      end
% 
        b(k)=bee(a(k),a0,alpha0);
        t1=zeros(length(r0),1);
        t2=zeros(length(r0),1);

        %term 1
        
        for i=1:length(r)
            t1(i)=yield(T(k,i),Y1,Tm)/r(i);
%             t2(i)=visc(T(k,i),Tm,B,eta_m)*a(k)*a(k)/(r(i)^4);
            t2(i)=visc2(T(k,i),TO,A,B)*a(k)*a(k)/(r(i)^4);
        end

        term1=2*trapz(r,t1);
        term2=-12*trapz(r,t2);

        term3=rho/2*(1-((a(k)^4)/(b(k)^4)));


        l1=(((term1+term2*x(k)+term3*x(k)*x(k)-P(k))/(rho*(1-(a(k)/b(k)))))-(2*x(k)*x(k)))/a(k);
        l2=(((term1+term2*(x(k)+d/2*l1)+term3*(x(k)+d/2*l1)*(x(k)+d/2*l1)-P(k))/(rho*(1-(a(k)/b(k)))))-(2*(x(k)+d/2*l1)*(x(k)+d/2*l1)))/a(k);
        l3=(((term1+term2*(x(k)+d/2*l2)+term3*(x(k)+d/2*l2)*(x(k)+d/2*l2)-P(k))/(rho*(1-(a(k)/b(k)))))-(2*(x(k)+d/2*l2)*(x(k)+d/2*l2)))/a(k);
        l4=(((term1+term2*(x(k)+d*l3)+term3*(x(k)+d*l3)*(x(k)+d*l3)-P(k))/(rho*(1-(a(k)/b(k)))))-(2*(x(k)+d*l3)*(x(k)+d*l3)))/a(k);

        x(k+1)=x(k) + (d/6)*(l1+2*l2+2*l3+l4);
        

%Temperature loop%    
for i=1:length(r0)

% 
%      m1=((-2*yield(T(k,i),Y1,Tm)*x(k)*(a(k)^2)/(r(i)^3))+(12*visc(T(k,i),Tm,B,eta_m)*x(k)*x(k)*(a(k)^4)/(r(i)^6)))/(rho*C);
%      m2=((-2*yield(T(k,i),Y1,Tm)*(x(k)+d/2*m1)*(a(k)^2)/(r(i)^3))+(12*visc(T(k,i),Tm,B,eta_m)*(x(k)+d/2*m1)*(x(k)+d/2*m1)*(a(k)^4)/(r(i)^6)))/(rho*C);
%      m3=((-2*yield(T(k,i),Y1,Tm)*(x(k)+d/2*m2)*(a(k)^2)/(r(i)^3))+(12*visc(T(k,i),Tm,B,eta_m)*(x(k)+d/2*m2)*(x(k)+d/2*m2)*(a(k)^4)/(r(i)^6)))/(rho*C);
%      m4=((-2*yield(T(k,i),Y1,Tm)*(x(k)+d*m3)*(a(k)^2)/(r(i)^3))+(12*visc(T(k,i),Tm,B,eta_m)*(x(k)+d*m3)*(x(k)+d*m3)*(a(k)^4)/(r(i)^6)))/(rho*C);


     m1=((-2*yield(T(k,i),Y1,Tm)*x(k)*(a(k)^2)/(r(i)^3))+(12*visc2(T(k,i),TO,A,B)*x(k)*x(k)*(a(k)^4)/(r(i)^6)))/(rho*C);
     m2=((-2*yield(T(k,i),Y1,Tm)*(x(k)+d/2*m1)*(a(k)^2)/(r(i)^3))+(12*visc2(T(k,i),TO,A,B)*(x(k)+d/2*m1)*(x(k)+d/2*m1)*(a(k)^4)/(r(i)^6)))/(rho*C);
     m3=((-2*yield(T(k,i),Y1,Tm)*(x(k)+d/2*m2)*(a(k)^2)/(r(i)^3))+(12*visc2(T(k,i),TO,A,B)*(x(k)+d/2*m2)*(x(k)+d/2*m2)*(a(k)^4)/(r(i)^6)))/(rho*C);
     m4=((-2*yield(T(k,i),Y1,Tm)*(x(k)+d*m3)*(a(k)^2)/(r(i)^3))+(12*visc2(T(k,i),TO,A,B)*(x(k)+d*m3)*(x(k)+d*m3)*(a(k)^4)/(r(i)^6)))/(rho*C);


    T(k+1,i)=T(k,i)+(d/6)*(m1+2*m2+2*m3+m4);

end


if alpha(k+1)<1
    break;
    k
end


end



end




% 


function eta=visc2(T,TO,A,B)
% eta= eta_m*exp(B*((1/T)-(1/Tm)));
eta=10^(A+B/(T-273-TO));
end


function r=arr(r0,a0,a)
r=(r0^3-a0^3+a^3)^(1/3);
end

function b = bee(a,a0,alpha0)
b = (a^3+(a0^3/(alpha0-1)))^(1/3);
end

function Y=yield(T,Y1,Tm)
Y=Y1*(1-(T/Tm));
end

function eta=visc(T,Tm,B,eta_m)
eta= eta_m*exp(B*((1/T)-(1/Tm)));
end
